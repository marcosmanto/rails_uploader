// $(function(){

	// var sender = $('form[name="enviardados"]');
	// var loader = $('.resposta');
	
		/*
	sender.submit(function(){
		$.ajax({
			data:	$(this).serialize(),
			type:	'POST',
			url:	"php/controller.php",
			success: function( resposta ){
					loader.empty().html('<pre>'+resposta+'</pre>');
			}
			
		});
		return false;	
	});
*/	
	// sender.submit(function(){
	// 	$(this).ajaxSubmit({
	// 		url:	"php/controller.php",
	// 		target: loader	
	// 	});
	// 	return false;	
	// });
	

	
	// sender.submit(function(){
		
	// 	$(this).ajaxSubmit({
	// 		url:	"php/controller.php",
	// 		data:	{acao: 'cadastro', envia: 'true'},
	// 		//target: loader,
	// 		//type: 	"GET"
	// 		beforeSerialize:	function(){
	// 				loader.empty().text("Obtendo dados.");
	// 			},
				
	// 		beforeSubmit:		function(){
	// 				loader.empty().text('Carregando...');
	// 			},
				
	// 		//clearForm: true LIMPA
	// 		resetForm: true, //REAJUSTA
	// 		dataType: null, //XML, json, script
			
	// 		error: function(){
	// 				loader.empty().text('Erro ao enviar');
	// 			},
				
	// 		//forceSync: false
			
	// 		success: function( sucesso ){
	// 			loader.empty().html('<pre>' + sucesso + '</pre>');
	// 		},
			
	// 		complete: function(){
	// 				loader.append('Concluido..');
	// 		},
			
	// 		uploadProgress: function(evento, posicao, total, porcentoCompleto){
	// 				loader.html(porcentoCompleto);
	// 		}
	// 	});
				
	// 	return false;	
	// });
// });
Shadowbox.init();
$(function(){
	// var sender = $('form[name="uploader"]');

	var modal 	= $('.modal');
	var menu	= $('.menu li a');
	var lista	= $('.lista');
	var loader	= $('.loading');

	menu.closest('li').removeClass('uk-active');
	
	// lista.hide();
	loader.hide();
	modal.hide();
	
	menu.click(function(e){
		var este = $(this);
		menu.closest('li').removeClass('uk-active');
		este.closest('li').addClass('uk-active');
		var local = este.attr('href').slice(1);
		// local = local.replace('#','');
		if(este.hasClass('cadastrar_imagem')){
			$.ajax({
				url: 'images/new',
				error: function(){ alert('Erro ao ler dados!'); },
				success: function( resposta ){
					$(".modal").html(resposta).fadeIn("fast");
				}
			});
		}else{
			lerdados( local );
		}
		return false;
	});

  $('.modal').on('change', '#upload-select1', function(){
  	// debugger;
  	$(".filename").html( $(this).val().replace(/^.*[\\\/]/, '') );
  	$(".selecione").hide();
  });	

	$('.modal').on('click','.closemodal', function(){
		// var local = window.location.hash;
		// local = local.replace('#','');
		lerdados( 'images' );
		modal.delay(300).fadeOut("slow", function(){
			$('.cadastrar_imagem').parent().removeClass('uk-active');
		});
		return false;			
	});
	
	function lerdados( local ){
		$.ajax({
			url: local,
			// url: 'images',
			// data: 'acao=ler&tipo='+local,
			error: function(){ alert('Erro ao ler dados!'); },
			beforeSend: function(){ loader.fadeIn("fast"); },
			//success: function( resposta ){ lista.empty().append( resposta ).fadeIn("slow"); },
			success: function( resposta ){
				lista.fadeTo(300,0.2,function(){
					$(this).html( resposta ).fadeTo(1000,1);
				});	
			},
			complete: function(){ loader.fadeOut("slow"); }
		});
	}
	
	// lerdados( local );
		
	lista.on('click','.actionedit',function(){
		var url= $(this).attr('href');
		var image_id = $(this).attr('class').split(' ')[1]
		var li = lista.find('li[class*="j_'+ image_id +'"]');
		$.ajax({
			url: url,
			error: function(){ alert('Erro ao ler dados!'); },
			success: function( resposta ){
				console.log(resposta);
				$(".modal").html(resposta).fadeIn("fast");
			}
		});	
		return false;
	});	
	
	lista.on('click','.actiondelete',function(e){
		e.preventDefault();
		var url= $(this).attr('href');
		// console.log(url.slice(1));
		var image_id = $(this).attr('class').split(' ')[1]
		var li = lista.find('li[class*="j_'+ image_id +'"]');
		$.ajax({
			url: url,
			// data: 'acao=deletar&delid='+id,
			error: function(){ alert('Erro ao ler dados!'); },
			beforeSend: function(){ li.find('.li-box').css("background","#FCC"); },
			success: function( resposta ){ 
				li.fadeOut("slow",function(){
					// var local = window.location.hash;
					// local = local.replace('#','');
					window.setTimeout(function(){ lerdados( 'images' ); },500);	
				});
			},
			complete: function(){ loader.fadeOut("slow"); }
		});
	});	
	
	lista.on('click','a[rel*="shadowbox"]',function(){
		Shadowbox.open(this);
		return false;	
	});

  // var settings    = {
  //     params: $('form[name="uploader"] :input').serializeArray(),
  //     action: 'php/controller.php', // upload url

  //     allow : '*.(jpg|jpeg|gif|png)', // allow only images

  //     loadstart: function() {
  //         bar.css("width", "0%").text("0%");
  //         progressbar.removeClass("uk-hidden");
  //     },

  //     progress: function(percent) {
  //         percent = Math.ceil(percent);
  //         bar.css("width", percent+"%").text(percent+"%");
  //     },

  //     allcomplete: function(response) {

  //         bar.css("width", "100%").text("100%");

  //         setTimeout(function(){
  //             progressbar.addClass("uk-hidden");
  //         }, 250);

  //         alert("Upload Completed");
  //         // loader.empty().html(response);
  //     }
  // };

  /* var select = UIkit.uploadSelect($("#upload-select"), settings),
      drop   = UIkit.uploadDrop($("#upload-drop"), settings);
  $.UIkit.uploadSelect($("#upload-select1"), settings); */

  $('.modal').on('submit','form[name="uploader"]', function(){
  	var debugger_span = $('#debug');
  	var progressbar = $("#progressbar"),
      	bar         = progressbar.find('.uk-progress-bar');
    var filename_span = $(".filename");
  	$(this).ajaxSubmit({
  		data: {acao: "cadastro"},
      beforeSubmit: function() {
      	debugger_span.fadeIn(1000);
      	debugger_span.removeClass().addClass('uk-alert').empty().html('<img src="<%= asset_path("load.gif") %>" width="20" alt="Aguarde carregamento..." title="Aguarde carregamento...">&nbsp;&nbsp;Aguarde carregamento... ');
        bar.css("width", "0%").text("0%");
        progressbar.removeClass("uk-hidden").css('display','none').fadeIn('fast');
      },
      error: function(){ alert('Erro ao enviar dados!'); },
      resetForm: true,
      uploadProgress: function(evt, pos, total, percent) {
          percent = Math.ceil(percent);
          bar.css("width", percent+"%").text(percent+"%");
      },      
      success: function(response){
        if(response.toLowerCase().indexOf("erro") > -1){
        	debugger_span.addClass('uk-alert-danger');
        } else {
        	debugger_span.addClass('uk-alert-success');
        }      	
      	debugger_span.empty().html(response);
      	filename_span.empty();
 				bar.css("width", "100%").text("100%");
        setTimeout(function(){
            progressbar.fadeOut("slow",function(){
            	$(this).addClass("uk-hidden");
            	debugger_span.fadeOut(1000,function(){
            		$(this).addClass("uk-hidden");
            	});
            });
        }, 1000);
        // alert("Upload Completed");      	
      },
  	});
  	return false;
  });



});